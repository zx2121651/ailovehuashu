# 全身/面部 2D 转 3D 动画捕捉系统

这是一个基于 Python 的桌面端应用程序，能够使用您的摄像头或本地视频文件，实现人物的实时 2D 转 3D 骨骼和面部动画捕捉。本软件底层使用 OpenCV 处理视频和图像，结合 Google MediaPipe Holistic 库进行精准的 3D 特征点提取。

## 核心功能

*   **多模式输入**：支持直接打开设备摄像头进行实时面部及肢体捕捉，也支持选择本地视频文件 (mp4, avi 等) 进行捕捉。
*   **全方位捕捉**：利用 MediaPipe Holistic 模型，同时捕捉人物面部 (468 个 3D 关键点)、身体姿态 (33 个 3D 关键点)、左/右手势 (每只手 21 个 3D 关键点)。
*   **实时预览**：在软件界面上实时渲染出从 2D 画面推断出来的 3D 人体网格和骨架。
*   **数据导出**：支持一键将捕捉到的所有 3D 坐标数据 (x, y, z 深度，以及可见性 v) 序列化录制，并可将其导出保存为标准的 JSON 文件，方便后续导入至各种 3D 建模工具（如 Blender/Maya/Unity 等）用于驱动虚拟数字人或进行骨骼重定向。

## 环境要求与安装配置

请确保您安装了 Python 3.8 或更高版本。

1.  克隆本仓库到本地。
2.  (可选) 创建并激活一个 Python 虚拟环境：
    ```bash
    python -m venv venv
    source venv/bin/activate  # MacOS/Linux
    venv\Scripts\activate     # Windows
    ```
3.  使用 pip 安装运行所需的依赖：
    ```bash
    pip install -r requirements.txt
    ```
    > 依赖说明：`opencv-python` (用于视频 I/O 和图像处理)，`mediapipe` (用于 3D 关键点推理)，`numpy` (数学运算)。`tkinter` 和 `json` 通常随 Python 标准库自动安装。

## 运行与使用方法

1.  进入项目根目录，运行主程序：
    ```bash
    python main.py
    ```
2.  此时将弹出一个带有控制面板的窗口：
    *   点击 **“打开摄像头”** 即可尝试连接您的默认摄像头进行捕捉。
    *   点击 **“选择本地视频”** 可通过文件浏览器选取您想处理的视频。
    *   点击 **“开始/暂停”** 控制视频的播放和画面的更新。
    *   当画面更新正常时，点击 **“开始录制 (JSON)”**，按钮会变为红色，表明此时系统正在将每一帧识别到的脸部和身体数据记录在内存中。
    *   捕捉完毕后，点击 **“停止录制并导出”**，系统会弹出保存对话框，您可以选择路径将捕捉到的 JSON 文件存储在您的电脑上。

## 导出的 JSON 数据结构

导出的 `*.json` 文件结构如下：

```json
{
  "frames": 100,
  "fps": 24.5,
  "data": [
    {
      "frame_id": 0,
      "timestamp": 0.0,
      "face": [
        {"x": 0.5, "y": 0.5, "z": -0.1, "v": 1.0},
        ... (468 points)
      ],
      "pose": [ ... (33 points) ],
      "left_hand": [ ... (21 points) ],
      "right_hand": [ ... (21 points) ]
    },
    ...
  ]
}
```

*注：部分帧中可能会因为特征点未出现在画面内或被遮挡，导致对应的数组内容为 `null`，请在后续数据解析处理时做好容错。*
